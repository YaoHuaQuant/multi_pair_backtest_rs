# multi_pair_backtest_rs
支持多种交易对的量化交易回测框架
## 目录架构
```
- doc // 文档
- src
    - bin // 可执行文件入口
    - strategy // 策略
        - strategy_order // 策略订单 及 订单管理器
        - strategy_trading_pair // 策略交易对 及 交易对管理器
    - runner // 执行器
        - strategy_runner // 回测执行器
            - runner_order // 执行器订单 及 订单管理器
            - runner_trading_pair // 执行器交易对 及 交易对管理器
            - runner_data_manager // 执行器数据管理器
        - okx_runner // 实盘执行器 对接okx
        - binance_runner // 实盘执行器 对接bn
    - order
        - order_enum // 订单公共属性枚举
    - data // 数据管理
        - db // 数据库连接
        - kline // k线
        - funding_rate // 资金费率
    - assert // 资产管理
        - trading_pair // 交易对
        - assert // 资产 及 资产管理器
    - protocol // 数据传输协议
```
## todolist(log)
### 20250417
 - [x] 回测数据选择
   - Mk1回测执行速度越1~3条k线/s 快速回测时尽量选择合适数量的k线 建议回测1天的数据（1440条k线，约耗时10分钟）
   - 回测起始的价格尽量一致，建议选择价格为10W左右，方便计算资产和收益率。
   - 选择周期:回测周期(东八区)'2025-01-27 13:40:00' and '2025-01-28 24:22:00'
 - 回测执行效率问题
   - 问题表现：回测过程中执行效率随着数据规模扩大、执行过程进展，会逐渐变慢。
   - 原因：数据积累
   - [x] 优化方案1) 订单rollup: 在做资产统计时将多个订单合并（主要是已完成订单中的fee asset）
   - [ ] todo 优化方案2) 输入数据拆分，从DB读取数据时按时间分片，只读取一小段时间（比如1天）的数据，减少BTree的数据量，从而提高读写速度。
   - [ ] todo 优化方案3) 输出数据拆分，将DataLog数据定期做持久化，在内存中保留rollup数据，将明细数据定期append至磁盘文件，同时可以将输出数据的粒度细化。
 - Mk1策略优化
   - 问题1) 资金利用率不足
     - 从手续费（1个月手续费仅185USDT）可以看出
     - 解决方案：
       1. 改用动态调仓策略(即升级至Mk3)
   - [ ] 问题2) 收益率过低
     - 订单间的价格差较小，mk1的等仓位策略会导致开仓平仓订单的利差过低（甚至低于手续费）
     - 解决方案：
       1. 引入策略订单，建立开仓订单和平仓订单之间的映射，避免止损(不止损)。
       2. 设置最小止盈，保证开仓订单和平仓订单的利差高于手续费(有效止盈)。